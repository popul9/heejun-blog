---
import { getLangFromUrl, getLocalizedPathname } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const path = Astro.url.pathname;

// Since there are only two languages, link directly to the other one
const targetLang = lang === "ko" ? "en" : "ko";
const targetUrl = getLocalizedPathname(path, targetLang);
const targetLabel = targetLang === "ko" ? "í•œ" : "EN";
---

<a
    href={targetUrl}
    class="floating-lang-toggle"
    aria-label={`Switch to ${targetLang === "ko" ? "Korean" : "English"}`}
>
    <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="1.8"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="globe-icon"
    >
        <circle cx="12" cy="12" r="10"></circle>
        <path d="M2 12h20"></path>
        <path
            d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"
        ></path>
    </svg>
    <span class="toggle-label">{targetLabel}</span>
</a>

<style>
    .floating-lang-toggle {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.55rem 0.9rem;
        border-radius: 999px;
        background: rgb(var(--gray-dark));
        color: white;
        text-decoration: none !important;
        font-size: 0.85rem;
        font-weight: 600;
        letter-spacing: 0.02em;
        box-shadow: 0 4px 14px rgba(0, 0, 0, 0.15), 0 1px 3px rgba(0, 0, 0, 0.1);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
    }

    .floating-lang-toggle:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2), 0 2px 6px rgba(0, 0, 0, 0.12);
    }

    .floating-lang-toggle:active {
        transform: translateY(0) scale(0.97);
        transition-duration: 0.1s;
    }

    .globe-icon {
        flex-shrink: 0;
    }

    .toggle-label {
        line-height: 1;
    }

    /* Mobile adjustments */
    @media (max-width: 720px) {
        .floating-lang-toggle {
            bottom: 1.25rem;
            right: 1.25rem;
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
        }

        .globe-icon {
            width: 17px;
            height: 17px;
        }
    }

    /* Dark mode */
    @media (prefers-color-scheme: dark) {
        .floating-lang-toggle {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .floating-lang-toggle:hover {
            background: rgba(255, 255, 255, 0.22);
        }
    }
</style>
